<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Pecas </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="../css/home.css">
  <script defer src="../js/peca_editar.js"></script>
  <link rel="stylesheet" href="../css/calendar.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="../js/navegar.js"></script>
</head>

<body onload="principaisTecidos()">
  <header class="header py-4 bg-light px-0 mt-3">
    <div class="container d-flex justify-content-between align-items-center">
      <a href="javascript:void(0);">
        <img
          src="../assets/botao-voltar 4.svg"
          alt="botao-voltar"
          class="mx-3"
          onclick="voltar()"
      /></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
          <img
          src="../assets/burger-bar 1 (1).svg"
          alt="menu-lateral"
          class="navbar-toggler-icon mx-3"/>
      </button>
      <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel" style="background-color: #012171; color: white; border-radius: 1rem 0rem 0rem 1rem; width: 65%;">
        <div class="offcanvas-body">
          <ul class="navbar-nav justify-content-end flex-grow-1 pe-3 gap-4" style="font-size: larger; margin-left: 2rem; margin-top: 6rem;">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" onclick="irPara('../home.html')">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="irPara('../pedido.html')">Pedidos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="irPara('#')">Contatos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="irPara('../fichas/Lista_fichas.html')">Fichas</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="irPara('../Lista-peca.html')">Produtos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="irPara('../Lista-tecido.html')">Tecidos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" onclick="irPara('dashHome.html')">Monitoramento</a>
            </li>
        </div>
      </div>
    </div>
  </header>

  <div style="border-radius: 0% 0% 0% 50%; background-color: #012171; width: 100%; height: 12rem;" class="shadow">
    <div class="d-flex justify-content-around align-items-center pt-4">
        <div class="col-8">
            <h5 class="card-title fs-1" style="color: white; font-weight: 400;">Minhas Pecas</h5>
            <i class="card-subtitle mb-2" style="color: white; font-size: small;">Dados atualizados <span id="anoAtual"></span></i>
        </div>
        <img class="image col-4" style="width: 11%;" src="../assets/pecaIconeDash.svg"/>
    </div>
</div>

<div class="py-4 mx-4">
    <p style="color: #696969;">Essas são as peças que mais encantaram seus clientes este semestre!</p>
    <select class="form-select" aria-label="Default select example">
        <option selected>Qual mês deseja consultar</option>

      </select>
</div>

<div class="container bg-light rounded-4" style="width: 90%; margin-left: 5%;">
    <div style="width: 50%; margin: 0 auto;"></div>
        <canvas id="pecasChart"></canvas>
    </div>
</div> 

<div class="pt-4 mx-4">
    <p style="color: #696969;" class="text-center">As principais escolhas de tecidos utilizados foram</p>
</div>

<div id="tecidos" class="d-flex flex-column gap-3">
  <!-- Clientes modelo Model -->

</div>
</body>
<script>
  const ctx = document.getElementById('pecasChart').getContext('2d');
  
  const data = {
      labels: ['Red', 'Blue', 'Yellow', 'Green'],
      datasets: [{
          label: 'My Dataset',
          data: [300, 50, 100, 150],
          backgroundColor: [
              'rgba(255, 99, 132, 0.2)',
              'rgba(54, 162, 235, 0.2)',
              'rgba(255, 206, 86, 0.2)',
              'rgba(75, 192, 192, 0.2)',
          ],
          borderColor: [
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)',
              'rgba(255, 206, 86, 1)',
              'rgba(75, 192, 192, 1)',
          ],
          borderWidth: 1
      }]
  };

  const config = {
      type: 'doughnut',
      data: data,
      options: {
          responsive: true,
          plugins: {
              legend: {
                  display: false // Desabilitar a legenda padrão
              }
          }
      }
  };

  const myChart = new Chart(ctx, config);

  // Criar a legenda manualmente
  const legendContainer = document.getElementById('legend');
  data.labels.forEach((label, index) => {
      const legendItem = document.createElement('div');
      const colorBox = document.createElement('span');
      colorBox.style.backgroundColor = myChart.data.datasets[0].backgroundColor[index];
      legendItem.appendChild(colorBox);
      legendItem.appendChild(document.createTextNode(label));
      legendContainer.appendChild(legendItem);
  });
</script>
<script>

  const currentYear = new Date().getFullYear();
  document.getElementById("anoAtual").innerHTML = currentYear;

 async function principaisTecidos(){
    var id = sessionStorage.getItem("id")

    var year = currentYear

    const idUsuario = sessionStorage.getItem('id')
    // const data = await fetch(`http://localhost:8080/pecas/view/${idUsuario}?ano=${year}`);
    //     if (!data.ok) {
    //     throw new Error('Erro ' + data.statusText, data.message);
    //     }

    // const formatedData = await data.json()

    console.log("Resposta: ", formatedData)

      var FormatedData = [
      {
        "nome": "Algodão",
        "porcentagem": 50
      },
      {
        "nome": "Linho",
        "porcentagem": 30
      },
      {
        "nome": "ferro",
        "porcentagem": 20
      }
    ]

    FormatedData.forEach(tecido => {
      document.getElementById("tecidos").innerHTML += `
      <div class="card mx-4 mt-3 shadow rounded-4 py-1" style="background-color: #012171;">
      <div class="card-body d-flex gap-3 align-items-center mx-4">
        <blockquote class="blockquote mb-0 col-9 ">
          <p style="color: white; font-weight: 350;">${tecido.nome}</p>
        </blockquote>
        <div class="col-3 fs-2" style="color: white; font-weight: 350;"">
        ${tecido.porcentagem}%
        </div>
      </div>
    </div>
      `
    })

  }
</script>